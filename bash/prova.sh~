#!/bin/bash
# timeout.sh

#  Scritto da Stephane Chazelas
#+ e modificato dall'autore del libro.

INTERVALLO=5              # intervallo di timeout

leggi_temporizzazione() {
  timeout=$1
  nomevar=$2
  precedenti_impostazioni_tty=`stty -g`
  stty -icanon min 0 time ${timeout}0
  eval read $nomevar      # o semplicemente  read $nomevar
  stty "$precedenti_impostazioni_tty"
  # Vedi la pagina di manuale di "stty".
}

echo; echo -n "Come ti chiami? Presto! "
leggi_temporizzazione $INTERVALLO nome

#  Questo potrebbe non funzionare su tutti i tipi di terminale.
#  Il timeout massimo, infatti, dipende dallo specifico terminale.
#+ (spesso è di 25.5 secondi).

echo

if [ ! -z "$nome" ]  # se il nome è stato immesso prima del timeout...
then
  echo "Ti chiami $nome."
else
  echo "Tempo scaduto."
fi

echo

# Il comportamento di questo script è un po' diverso da "timed-input.sh".
# Ad ogni pressione di tasto, la temporizzazione ricomincia da capo.

exit 0


